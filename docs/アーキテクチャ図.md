# アーキテクチャ図

 以下は本アプリの高レベルなアーキテクチャ図です。ブラウザ（フロントエンド）と
 Cloudflare Workers（バックエンド）、および外部サービス連携の流れを示しています。

```mermaid
 flowchart LR
   subgraph Browser[ブラウザ（フロントエンド）]
     A[React + Vite + TypeScript]
     B[Google Identity Services]
     C[DuckDB-WASM]
     D[Monaco Editor]
     E[Chart.js & TanStack Table]
     F[OPFS / IndexedDB（キャッシュ）]
   end

   subgraph Cloudflare[Cloudflare Worker（バックエンド）]
     G[Workers Function]
     H[Cloudflare R2（Parquet 保存）]
   end

   subgraph Google[Google API]
     I[GA4 Data API]
   end

   %% フロー定義
   A -->|OAuth 2.0 認証| B
   B -->|アクセストークン| G
   G -->|GA4 データ取得| I
   I -->|"分析データ(JSON)"| G
   G -->|Parquet 変換・保存| H
   H -->|署名付きURL| A
   A -->|Parquet ダウンロード| C
   C -->|SQL クエリ実行| E
   C -->|分析結果表示| E
   D -->|SQL 編集| C
   C -->|キャッシュ| F
   F -->|再利用| C
```

 ## 説明
 - ブラウザ上で React+TypeScript の SPA として動作し、Google Identity Services で OAuth2 認証を行う
 - 認証情報を Workers に渡し、GA4 Data API から生データを取得、Parquet に変換して R2 に保存
 - 保存した Parquet は署名付き URL 経由でブラウザにダウンロードされ、DuckDB-WASM でクエリ可能
 - Monaco Editor で SQL を編集し、Chart.js / TanStack Table で可視化
 - OPFS / IndexedDB を利用して Parquet データとクエリをローカルキャッシュ